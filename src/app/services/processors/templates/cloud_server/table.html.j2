{% macro render(projects) %}
    {% set projects = projects %}
    {% for project in projects %}
        <div class="mt-4">
            <div class="row mb-2">
                <span class="col-10 table-title-name">
                    <b>Bảng {{ project.idx_project }}: </b>
                    Chi tiết cước phí dự án

                    <span>
                        <b>{{ project.project_name }}</b>
                    </span>
                </span>
                <div class="col-2 table-title-note text-right">
                    <span>
                        <i>đơn vị thanh toán: VNĐ</i>
                    </span>
                </div>
            </div>
        </div>
        <table class="mt-1 table invoice-table">
            <thead>
            <tr>
                <th>STT</th>
                <th>Tài nguyên</th>
                <th>Từ ngày</th>
                <th>Đến ngày</th>
                <th>Sử dụng</th>
                <th>Chi phí</th>
                <th>Chiết khấu (%)</th>
                <th>Tiền chiết khấu</th>
                <th>Chi phí sau chiết khấu</th>
                <th>Đã thanh toán</th>
                <th>Chưa thanh toán</th>
            </tr>
            </thead>
            <tbody>
            {% for bill in table.list_bill_info %}
                {% if bill.sub_inactive %}
                    <tr class="title-line">
                        <td class="text-center">{{ bill.index }}</td>
                        <td class="text-left"> {{ bill.resource_name }}</td>
                        <td class="text-center"> {{ bill.term_start_date }}</td>
                        <td class="text-center"> {{ bill.term_end_date }}</td>
                        <td class="text-center"> {{ bill.usage }}</td>
                        <td class="text-center"></td>
                        <td class="text-right">{{ bill.subtotal }}</td>
                        <td class="text-right"> {{ bill.discount_percent }}</td>
                        <td class="text-right">{{ bill.child_discount_after }}</td>
                        <td class="text-right">{{ bill.total_paid }}</td>
                        <td class="text-right">{{ bill.total_unpaid }}</td>
                    </tr>
                    {% for bill_line in bill.bill_lines %}
                        <tr class-debug="{{ bill_line.debug }}">
                            <td class="text-left"></td>
                            <td>
                                <span>{{ bill_line.summary }} </span>
                            </td>
                            <td class="text-center">
                                {{ bill_line.term_start_date }}
                            </td>
                            <td class="text-center">
                                {{ bill_line.term_end_date }}
                            </td>
                            <td class="text-center">{{ bill_line.usage }}</td>
                            <td class="text-right">{{ bill_line.subtotal }}</td>
                            <td class="text-center">{{ bill_line.discount_percent }}</td>
                            <td class="text-right">{{ bill_line.discount_money }}</td>
                            <td class="text-right">{{ bill_line.discount_after }}</td>
                            <td class="text-right">{{ bill_line.total_paid }}</td>
                            <td class="text-right">{{ bill_line.total_unpaid }}</td>

                        </tr>
                    {% endfor %}
                {% else %}

                    <tr class="region">
                        <td class="text-left" colspan="8">
                            <span class="ml-2">Region: {{ bill.region.region_name }}</span>
                        <td class="text-right">{{ bill.region.region_total_after_discount }}</td>
                        <td class="text-right">{{ bill.region.region_paid }}</td>
                        <td class="text-right">{{ bill.region.region_unpaid }}</td>
                        </td>
                    </tr>
                    {% for b_infor in bill.bill_infor %}

                        <tr class="title-line">
                            <td class="text-center">{{ b_infor.index }}</td>
                            <td class="text-left"> {{ b_infor.bill_resource_name }}</td>
                            <td class="text-center"> {{ b_infor.term_start_date }}</td>
                            <td class="text-center"> {{ b_infor.term_end_date }}</td>
                            <td class="text-center"></td>
                            <td class="text-right">{{ b_infor.subtotal }}</td>
                            <td class="text-center">{{ b_infor.discount_percent }}</td>
                            <td class="text-right">{{ b_infor.total_discount }}</td>
                            <td class="text-right">{{ b_infor.total_after_discount }}</td>
                            <td class="text-right">{{ b_infor.total_paid }}</td>
                            <td class="text-right">{{ b_infor.total_unpaid }}</td>
                        </tr>
                        {% for bill_line in b_infor.bill_line_infor %}
                            {% if bill_line.instance %}
                                <tr>
                                    <td class="text-left"></td>
                                    <td class="text-left" colspan="10"><b>{{ bill_line.instance_vn }}</b></td>
                                </tr>
                                {% for instance in bill_line.instance_resource %}
                                    <tr class-debug="{{ instance.debug }}">
                                        <td class="text-center"></td>
                                        <td class="text-left"> {{ instance.summary }}</td>
                                        <td class="text-center"> {{ instance.term_start_date }}</td>
                                        <td class="text-center"> {{ instance.term_end_date }}</td>
                                        {% if instance.line_action == 'on' or instance.line_action == 'off' %}
                                            <td class="text-center">{{ instance.line_action_vn }} {{ instance.line_quantity }}
                                                giờ
                                            </td>
                                        {% else %}
                                            <td class="text-center">{{ instance.line_quantity }} giờ</td>
                                        {% endif %}
                                        <td class="text-right">{{ instance.subtotal }}</td>
                                        <td class="text-center">{{ instance.line_discount_percent }}</td>
                                        <td class="text-right">{{ instance.total_discount }}</td>
                                        <td class="text-right">{{ instance.total_after_discount }}</td>
                                        <td class="text-right">{{ instance.total_paid }}</td>
                                        <td class="text-right">{{ instance.total_unpaid }}</td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr class-debug="{{ bill_line.debug }}">
                                    <td class="text-center"></td>
                                    <td class="text-left"> {{ bill_line.summary }}</td>
                                    <td class="text-center"> {{ bill_line.term_start_date }}</td>
                                    <td class="text-center"> {{ bill_line.term_end_date }}</td>
                                    {% if line_action is none %}
                                        <td class="text-center"> {{ bill_line.line_quantity }} giờ</td>
                                    {% else %}
                                        <td class="text-center">{{ bill_line.line_action_vn }} {{ bill_line.line_quantity }}
                                            giờ
                                        </td>
                                    {% endif %}
                                    <td class="text-right">{{ bill_line.subtotal }}</td>
                                    <td class="text-center">{{ bill_line.line_discount_percent }}</td>
                                    <td class="text-right">{{ bill_line.total_discount }}</td>
                                    <td class="text-right">{{ bill_line.total_after_discount }}</td>
                                    <td class="text-right">{{ bill_line.total_paid }}</td>
                                    <td class="text-right">{{ bill_line.total_unpaid }}</td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
            </tbody>
            <tfoot>

            <tr class="red-color">

                <td colspan="5" class="text-right">Tổng:</td>
                {% if table.total_bill %}
                    <td class="text-right">{{ table.total_bill.subtotal }}</td>
                    <td class="text-right"></td>
                    <td class="text-right">{{ table.total_bill.total_discount }}</td>
                    <td class="text-right">{{ table.total_bill.total_after_discount }}</td>
                    <td class="text-right">{{ table.total_bill.total_paid }}</td>

                    <td class="text-right">{{ table.total_bill.total_unpaid }}</td>
                {% else %}
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                    <td class="text-right">0</td>
                {% endif %}
            </tr>
            </tfoot>
        </table>
    {% endfor %}
    <p class="mt-1 mb-4 text-right">
        <small>
            <i>Chi phí đã bao gồm VAT</i>
        </small>
    </p>
{% endmacro %}